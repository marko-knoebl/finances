<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Finances</title>
    <script src="node_modules/kontojs/konto.js"></script>
    <script src="https://fb.me/react-15.1.0.js"></script>
    <script src="https://fb.me/react-dom-15.1.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  </head>

  <body>
    <div id="finances-app"></div>

    <script type="text/babel">
      var dataset = new konto.Dataset();
      dataset.addAccount({id: 'main', openDate: '2016-06-27'});

      var addTransaction = function() {
        var amount = parseFloat(document.querySelector('#amount_input').value);
        if (amount >= 0) {
          var origin = 'world';
          var destination = 'main';
        } else {
          var origin = 'main';
          var destination = 'world';
        }
        var details = document.querySelector('#details_input').value;
        var date = document.querySelector('#date_input').value;
        dataset.addTransaction({
          amount: Math.abs(amount),
          origin: origin,
          destination: destination,
          details: details,
          date: date,
        });
        document.querySelector('#amount_input').value = '0';
        document.querySelector('#details_input').value = '';
        document.querySelector('#date_input').value = '';
        rerender();
      };

      var addRandomTransactionData = function() {
        var randomData = dataset.getRandomTransactionData(30);
        randomData.forEach(function(transaction) {
          dataset.addTransaction(transaction);
        });
        rerender();
      };

      var getBalance = function() {
        var balance = 0;
        dataset.transactions.forEach(function(transaction) {
          if (transaction.destination === 'main') {
            balance += transaction.amount;
          } else if (transaction.origin === 'main') {
            balance -= transaction.amount;
          }
        });
        return balance;
      };

      var rerender = function() {
        ReactDOM.render(
          <div>
            <h1>Finances</h1>
            <div>
              Your balance is: {getBalance().toFixed(2)}
            </div>
            <div>
              <h2>Transactions</h2>
              {dataset.transactions.length === 0 ? 'no transactions' : ''}
              <table>
                <tbody>
                  {dataset.transactions.map(function(transaction) {
                    return <tr>
                      <td>
                        {transaction.origin==='main'?'-':''}
                        {transaction.amount.toFixed(2)}
                      </td>
                      <td>{transaction.details}</td>
                      <td>{transaction.date}</td>
                    </tr>;
                  })}
                </tbody>
              </table>
            </div>
            <div>
              <input id="amount_input" type="number" step="0.01"></input>
              <input id="details_input"></input>
              <input id="date_input" type="date"></input>
              <button onClick={addTransaction}>Add Transaction</button>
            </div>
            <button onClick={addRandomTransactionData}>Add random Transactions</button>
          </div>,
          document.getElementById('finances-app')
        );
      };
      rerender();
    </script>
  </body>
</html>
